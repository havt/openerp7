<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
    	 	<!-- PM and PMRef. and GPM - Rule for Stock move -->
			<record model="ir.rule" id="kderp_rule_dashboard_pm_stock_move">
		 		<field name="name">KDERP Dashboard - General and Project Manager see all Stock Move </field>
			 	<field name="model_id" ref="model_stock_move"/>
			 	<field name="global" eval="False"/>
		 		<field name="domain_force">[('id','in',"(select sm.id from stock_move sm left join stock_location sl on sm.location_id = sl.id left join jobs_stock_rel rsl on sl.id =rsl.stock_id where rsl.account_analytic_id in ( select id from account_analytic_account where %s in (user_id,project_manager_ref,general_project_manager_id)))")]</field>
		 		<field model="res.groups" name="groups" search="[('name', 'like', '%Project Manager Dashboard%')]"/>
			</record>
			
			<!-- SM, ASM  - Rule for Stock move -->
			<record model="ir.rule" id="kderp_rule_dashboard_pm_stock_move">
		 		<field name="name">KDERP Dashboard - General and Site Manager see all Stock Move </field>
			 	<field name="model_id" ref="model_stock_move"/>
			 	<field name="global" eval="False"/>
		 		<field name="domain_force">[('id','in',"(select sm.id from stock_move sm left join stock_location sl on sm.location_id = sl.id left join jobs_stock_rel rsl on sl.id =rsl.stock_id where rsl.account_analytic_id in ( select id from account_analytic_account where %s in (area_site_manager_id,manager_id)))")]</field>
		 		<field model="res.groups" name="groups" search="[('name', 'like',' %Site Manager Dashboard%')]"/>
			</record>
			
			<!-- PM and PMRef. and GPM - Rule for Stock picking -->
			<record model="ir.rule" id="kderp_rule_dashboard_sm_stock_picking">
		 		<field name="name">KDERP Dashboard - General and Project Manager see all Stock Picking </field>
			 	<field name="model_id" ref="model_stock_picking"/>
			 	<field name="global" eval="False"/>
		 		<field name="domain_force">[('id','in',"(select sp.id from stock_picking sp left join stock_location sl on sp.location_id = sl.id left join jobs_stock_rel rsl on sl.id =rsl.stock_id where rsl.account_analytic_id in ( select id from account_analytic_account where %s in (user_id,project_manager_ref,general_project_manager_id)))")]</field>
		 		<field model="res.groups" name="groups" search="[('name', 'like', '%Project Manager Dashboard%')]"/>
			</record>
			
			<!-- SM, ASM  - Rule for Stock picking -->
			<record model="ir.rule" id="kderp_rule_dashboard_sm_stock_picking">
		 		<field name="name">KDERP Dashboard - General and Site Manager see all Stock Picking </field>
			 	<field name="model_id" ref="model_stock_picking"/>
			 	<field name="global" eval="False"/>
		 		<field name="domain_force">[('id','in',"(select sp.id from stock_picking sp left join stock_location sl on sp.location_id = sl.id left join jobs_stock_rel rsl on sl.id =rsl.stock_id where rsl.account_analytic_id in ( select id from account_analytic_account where %s in(area_site_manager_id,manager_id)))")]</field>
		 		<field model="res.groups" name="groups" search="[('name', 'like',' %Site Manager Dashboard%')]"/>
			</record>
			
			
				<!-- PM and PMRef. and GPM - Rule for Stock location -->
			<record model="ir.rule" id="kderp_rule_dashboard_pm_stock_location">
		 		<field name="name">KDERP Dashboard - General and Project Manager see all Stock Location </field>
			 	<field name="model_id" ref="model_stock_location"/>
			 	<field name="global" eval="False"/>
		 		<field name="domain_force">[('id','in',"(select sl.id from  stock_location sl left join jobs_stock_rel rsl on sl.id =rsl.stock_id where rsl.account_analytic_id in ( select id from account_analytic_account where %s in (user_id,project_manager_ref,general_project_manager_id)))")]</field>
		 		<field model="res.groups" name="groups" search="[('name', 'like', '%Project Manager Dashboard%')]"/>
			</record>
			
			<!-- SM, ASM  - Rule for Stock location -->
			<record model="ir.rule" id="kderp_rule_dashboard_sm_stock_location">
		 		<field name="name">KDERP Dashboard - General and Site Manager see all Stock Location </field>
			 	<field name="model_id" ref="model_stock_location"/>
			 	<field name="global" eval="False"/>
		 		<field name="domain_force">[('id','in',"(select sl.id from  stock_location sl left join jobs_stock_rel rsl on sl.id =rsl.stock_id where rsl.account_analytic_id in ( select id from account_analytic_account where %s in (area_site_manager_id,manager_id)))")]</field>
		 		<field model="res.groups" name="groups" search="[('name', 'like',' %Site Manager Dashboard%')]"/>
			</record>
			
	<!-- 	
			storekeeper - Rule for Purchase
			<record model="ir.rule" id="kderp_rule_stockeeper_purchase_order">
		 		<field name="name">KDERP Stockeeper - Purchase Order </field>
			 	<field name="model_id" ref="kderp_purchase.model_purchase_order"/>
			 	<field name="global" eval="False"/>
		 		<field name="domain_force">[('id','in','(select id from purchase_order where id in ( select order_id from purchase_order_line pol left join stock_move sm on pol.id =sm.purchase_line_id left join stock_location sl on sm.location_id = sl.id left join storekeeper_user_rel srl on sl.id =srl.stock_id where  %s=srl.user_id))')]</field>
		 		<field model="res.groups" name="groups" search="[('name', 'like',' %Storekeeper%')]"/>
			</record>
			 -->
			<!-- storekeeper - Rule for Stock Move -->
			<!-- <record model="ir.rule" id="kderp_rule_stockeeper_stock_move">
		 		<field name="name">KDERP Stockeeper - Stock Move </field>
			 	<field name="model_id" ref="model_stock_move"/>
			 	<field name="global" eval="False"/>
	 		<field name="domain_force">[('id','in',"select sm.id from stock_move sm left join stock_location sl on sm.location_id = sl.id left join storekeeper_user_rel srl on sl.id =srl.stock_id where  %s=srl.user_id")]</field> 
		 		<field name="domain_force">[('location_id.storekeeper_ids','=',user.id)]</field>
		 		<field model="res.groups" name="groups" search="[('name', 'like',' %Storekeeper%')]"/>
			</record>
			 -->
	<!-- 		<record model="ir.rule" id="kderp_rule_stockeeper_stock_picking">
		 		<field name="name">KDERP Stockeeper - Stock Picking </field>
			 	<field name="model_id" ref="model_stock_picking"/>
			 	<field name="global" eval="False"/>
		 	<field name="domain_force">['|',('location_id.location_id.storekeeper_ids','=',user.id),('location_id.storekeeper_ids','=',user.id)]</field>
 		 			
		 		<field name="domain_force">[('id','in',"(select sp.id from stock_picking sp left join stock_location sl on sp.location_id = sl.id  left join storekeeper_user_rel srl on sl.id =srl.stock_id where  %s=srl.user_id) ")]</field> 
		 		<field model="res.groups" name="groups" search="[('name', 'like',' %Storekeeper%')]"/>
			</record> -->
			
			<record model="ir.rule" id="kderp_rule_stockeeper_location">
		 		<field name="name">KDERP Stockeeper - Stock Location </field>
			 	<field name="model_id" ref="model_stock_location"/>
			 	<field name="perm_read" eval="True"/>
				<field name="global" eval="False"/>
		 		<field name="domain_force">[('id','in','(select distinct sl.id from stock_location sl right join ( select location_id from stock_location sl left join storekeeper_user_rel si on si.stock_id =sl.id  where %s=user_id and location_id>0)qr on qr.location_id =sl.id or qr.location_id =sl.location_id)')]</field>
		 		<field model="res.groups" name="groups" search="[('name', 'like',' %Storekeeper%')]"/>
			</record>
			
    </data>
</openerp>
